<html><head></head>
<body>

<div><br></div><div><div><div>[root@k8s-registry compose_lnmp]# cd nginx/</div><div>[root@k8s-registry nginx]# ls</div><div>Dockerfile &nbsp;nginx-1.12.1.tar.gz &nbsp;nginx.conf</div></div><div><div><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); ">[root@k8s-registry nginx]#&nbsp;</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 0); "><b>cat Dockerfile</b></span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); ">&nbsp;</span></div><div><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); ">FROM centos:6</span></div><div><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); ">MAINTAINER lizhenliang</span></div><div><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); ">RUN yum install -y gcc gcc-c++ make openssl-devel pcre-devel</span></div><div><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); ">ADD nginx-1.12.1.tar.gz /tmp</span></div><div><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); ">RUN cd /tmp/nginx-1.12.1 &amp;&amp; ./configure --prefix=/usr/local/nginx &amp;&amp; make -j 2 &amp;&amp; make install</span></div><div><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); ">RUN rm -f /usr/local/nginx/conf/nginx.conf&nbsp;</span></div><div><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); ">COPY nginx.conf /usr/local/nginx/conf</span></div><div><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); "><br></span></div><div><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); ">EXPOSE 80</span></div><div><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); ">CMD ["/usr/local/nginx/sbin/nginx", "-g", "daemon off;"]</span></div></div><div><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); "><br></span></div><div><div><div><div>[root@k8s-registry nginx]<span class="Apple-style-span" style="background-color: rgb(255, 255, 0);"><b># cat nginx.conf&nbsp;</b></span></div><div>user &nbsp;root;&nbsp;</div><div>worker_processes &nbsp;auto;&nbsp;</div><div><br></div><div>error_log &nbsp;logs/error.log &nbsp;info;</div><div><br></div><div>pid &nbsp; &nbsp; &nbsp; &nbsp;logs/nginx.pid;&nbsp;</div><div><br></div><div><br></div><div>events {</div><div>&nbsp; &nbsp; use epoll;&nbsp;</div><div>}</div><div><br></div><div>http {</div><div><br></div><div>&nbsp; &nbsp; include &nbsp; &nbsp; &nbsp; mime.types;</div><div>&nbsp; &nbsp; default_type &nbsp;application/octet-stream;</div><div><br></div><div>&nbsp; &nbsp; log_format &nbsp;main '<span class="Apple-style-span" style="background-color: rgb(255, 255, 0);"><b>$upstream_addr</b></span> $remote_addr - $remote_user [$time_local] "$request" '</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; '$status $body_bytes_sent "$http_referer" '</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; '"$http_user_agent" "$http_x_forwarded_for"';</div><div><br></div><div>&nbsp; &nbsp; access_log logs/access.log main;</div><div>&nbsp; &nbsp; sendfile &nbsp; &nbsp; &nbsp; &nbsp;on;</div><div>&nbsp; &nbsp; keepalive_timeout &nbsp;65;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; &nbsp; upstream www.example.com {</div><div><span class="Apple-style-span" style="background-color: rgb(255, 255, 0);">&nbsp; &nbsp; &nbsp; &nbsp; #ip_hash;</span></div><div><span class="Apple-style-span" style="background-color: rgb(255, 255, 0);">&nbsp; &nbsp; &nbsp; &nbsp; server tomcat01:8080;</span></div><div><span class="Apple-style-span" style="background-color: rgb(255, 255, 0);">&nbsp; &nbsp; &nbsp; &nbsp; server tomcat02:8080;</span></div><div><span class="Apple-style-span" style="background-color: rgb(255, 255, 0);">&nbsp; &nbsp; &nbsp; &nbsp; server tomcat03:8080;</span></div><div><span class="Apple-style-span" style="background-color: rgb(255, 255, 0);">&nbsp; &nbsp; }</span></div><div><br></div><div>&nbsp; &nbsp; server {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; listen 80;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; server_name localhost;</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp; location / {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; proxy_pass http://www.example.com;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; }</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp; location ~ \.(html|css|js|jpg|png|gif)$ {</div><div><span class="Apple-style-span" style="background-color: rgb(255, 255, 0);"><b>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; root /opt/webapps/ROOT;</b></span></div><div>&nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; }</div><div>}</div></div></div></div></div></body></html>